# JSON 모듈을 임포트하여 파일로부터 데이터를 읽고 쓰는 기능을 제공
import json
import os

# 책 데이터를 저장할 JSON 파일 경로 설정
책파일경로 = "./books.json"


# ---------- 파일 입출력 ----------
def 책목록불러오기():
    """책 목록을 JSON 파일에서 불러오기 (파일 없으면 빈 리스트 반환)"""
    if not os.path.exists(책파일경로):
        return []
    with open(책파일경로, "r", encoding="utf-8") as f:
        return json.load(f)


def 책목록저장(책목록):
    """책 목록을 JSON 파일에 저장"""
    with open(책파일경로, "w", encoding="utf-8") as f:
        json.dump(책목록, f, ensure_ascii=False, indent=4)


# ---------- 재사용 유틸 ----------
def 번호로책찾기(책목록, 번호):
    """번호로 특정 책 찾기"""
    for 책 in 책목록:
        if 책["번호"] == 번호:
            return 책
    return None


# ---------- 기능 구현 ----------
def 책등록():
    제목 = input("책 제목을 입력하세요 >> ")
    저자 = input("저자를 입력하세요 >> ")

    책목록 = 책목록불러오기()

    # 다음 번호 계산
    if not 책목록:
        새번호 = 1
    else:
        최대번호 = 0
        for 책 in 책목록:
            if 책["번호"] > 최대번호:
                최대번호 = 책["번호"]
        새번호 = 최대번호 + 1

    새책 = {"번호": 새번호, "제목": 제목, "저자": 저자}

    책목록.append(새책)
    책목록저장(책목록)
    print(f"✅ '{새번호}. {제목}'(저자: {저자}) 가 등록되었습니다.")


def 책보기():
    책목록 = 책목록불러오기()
    if not 책목록:
        print("⚠️ 등록된 책이 없습니다.")
        return False
    print("\n[전체 책 목록]")
    for 책 in 책목록:
        print(f"{책['번호']}. {책['제목']} - {책['저자']}")
    return True


def 책업데이트():
    if not 책보기():
        return
    번호 = int(input("수정할 책 번호를 입력하세요 >> "))

    책목록 = 책목록불러오기()
    대상 = 번호로책찾기(책목록, 번호)
    if 대상 is None:
        print("❌ 해당 번호의 책을 찾을 수 없습니다.")
        return

    print(f"📖 선택된 책: {대상['제목']} - {대상['저자']}")
    새제목 = input("새로운 책 제목(변경하지 않으면 엔터) >> ")
    새저자 = input("새로운 저자(변경하지 않으면 엔터) >> ")

    if 새제목.strip():
        대상["제목"] = 새제목
    if 새저자.strip():
        대상["저자"] = 새저자

    책목록저장(책목록)
    print(f"✅ {번호}번 책 정보가 수정되었습니다.")


def 책대여():
    if not 책보기():
        return
    번호 = int(input("대여(삭제)할 책 번호를 입력하세요 >> "))

    책목록 = 책목록불러오기()
    대상 = 번호로책찾기(책목록, 번호)
    if 대상 is None:
        print("❌ 해당 번호의 책을 찾을 수 없습니다.")
        return

    제목 = 대상["제목"]
    책목록.remove(대상)
    책목록저장(책목록)
    print(f"📕 '{제목}' 책이 대여(삭제)되었습니다.")


# ---------- 메인 실행 루프 ----------
while True:
    print("\n===== 📚 책 관리 프로그램 =====")
    print("1. 책 등록")
    print("2. 책 조회")
    print("3. 책 업데이트(번호 기준)")
    print("4. 책 대여(삭제)")
    print("5. 종료")
    선택 = input("메뉴 번호를 입력하세요 >> ")

    if 선택 == "1":
        책등록()
    elif 선택 == "2":
        책보기()
    elif 선택 == "3":
        책업데이트()
    elif 선택 == "4":
        책대여()
    elif 선택 == "5":
        print("시스템을 종료합니다.")
        break
    else:
        print("❌ 잘못된 입력입니다. 1~5 중에서 선택하세요.")
